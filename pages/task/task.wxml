<view class='b-task-container'>
  <block wx:if="{{ runningTask || ( overTask && overTask.length !== 0 ) }}">
    <!-- 进行中任务列表 -->
    <block wx:if='{{ runningTask }}'>
      <view class='b-task-title'>
        <text>进行中</text>
      </view>
      <view class='b-task-content'>
        <view class='b-cotnent-detail'>
          <block wx:if="{{ status !== 'runingFixed' && status !== 'runingByTime' }}">
            <view>
              <!-- 状态标题 -->
              <view class='b-task-status-title'>
                <view class='b-task-tip'>
                  <text wx:if="{{ status === 'subscribed' || status === 'subscribeOvertime' }}">请在规定时间前往安装</text>
                  <text wx:if="{{ status === 'signedWaitInstall' }}">请及时关注网点安装进度</text>
                  <text wx:if="{{ status === 'installing' }}">请耐心等待广告安装完成</text>
                  <text wx:if="{{ status === 'installed' }}">请及时上传车辆上画照片</text>
                  <text wx:if="{{ status === 'installAudit' }}">请耐心等待安装审核</text>
                  <text wx:if="{{ status === 'installFail' || status === 'rework' }}">安装审核结果</text>
                  <text wx:if="{{ status === 'needCheck' }}">请尽快完成自主检测</text>
                  <text wx:if="{{ status === 'checkAudit' }}">请耐心等待检测审核</text>
                  <text wx:if="{{ status === 'checkfail' }}">检测审核结果</text>
                </view>
                <view class='b-task-status'>
                  <text wx:if="{{ status === 'subscribed' || status === 'subscribeOvertime' || status === 'signedWaitInstall' }}">待安装</text>
                  <text wx:if="{{ status === 'installing' }}">安装中</text>
                  <text wx:if="{{ status === 'installed' }}">安装完成</text>
                  <text wx:if="{{ status === 'installAudit' }}">审核中</text>
                  <text wx:if="{{ status === 'installFail' || status === 'rework' }}">投放异常</text>
                  <text wx:if="{{ status === 'needCheck' }}">待检测</text>
                  <text wx:if="{{ status === 'checkAudit' }}">检测中</text>
                  <text wx:if="{{ status === 'checkfail' }}">检测异常</text>
                </view>
              </view>
              <!-- 未签到 -->
              <block wx:if="{{ status === 'subscribed' || status === 'subscribeOvertime' }}">
                <view class='b-content-margin'>
                  <view class='b-subscribe-info'>
                    <image class='b-time-image' src='{{ runningTask.logo }}'></image>
                    <view class='b-time-text'>
                      <text>{{ runningTask.reserveDate.subscribeTime }}</text>
                    </view>
                    <view class='b-location-distance'>
                      <text>{{ distance }}km</text>
                    </view>
                  </view>
                  <view class='b-address' bindtap='handleShowAddress' data-address='{{ runningTask.reserveDate.server_name }}'>
                    <image class='b-time-image' src='https://wxapi.benpaobao.com/static/app_img/v2/b-location-icon.png'></image>
                    <view class='b-time-text'>
                      <text>{{ runningTask.reserveDate.server_name }}</text>
                    </view>
                    <!-- 导航 -->
                    <view class='b-go-map' catchtap='handleNavigation'>
                      <image class='b-map-image' src='https://wxapi.benpaobao.com/static/app_img/v2/b-nav-icon.png'></image>
                      <view class='b-map-text'>
                        <text>导航</text>
                      </view>
                    </view>
                  </view>
                  <view class='b-overtime-tip'>
                    <text>已超时！剩余24分23秒自动取消</text>
                  </view>
                </view>
              </block>
              <!-- 已签到未安装、安装未上画-->
              <block wx:elif="{{ status === 'signedWaitInstall' || status === 'installing' || status === 'installed' }}">
                <view class='b-content-margin'>
                  <view class='b-signed-wait-install'>
                    <view class='b-subscribe-info'>
                      <image class='b-time-image' src='https://wxapi.benpaobao.com/static/app_img/v2/b-keep-time.png' mode='aspectFill'></image>
                      <view class='b-time-text'>
                        <text wx:if="{{ status === 'signedWaitInstall' }}">已等待{{ waitTime }}</text>
                        <text wx:if="{{ status === 'installing' }}">已安装{{ installTime }}</text>
                        <text wx:if="{{ status === 'installed' }}">安装用时{{ installOverTime }}</text>
                      </view>
                    </view>
                    <view class='b-address'>
                      <image class='b-time-image' src='https://wxapi.benpaobao.com/static/app_img/v2/b-loading-icon.png'></image>
                      <view class='b-need-wait-text'>
                        <text wx:if="{{ status === 'signedWaitInstall' }}">还需等待 {{ waitInfo.signInPosition }} 位</text>
                        <text wx:if="{{ status === 'installing' }}">请耐心等待安装完成</text>
                        <text wx:if="{{ status === 'installed' }}">等待上传车辆画面</text>
                      </view>
                    </view>
                  </view>
                </view>
              </block>
              <!-- 安装审核中、检测审核中 -->
              <block wx:elif="{{ status === 'installAudit' || status === 'checkAudit' }}">
                <view class='b-content-margin'>
                  <view class='b-audit-info'>
                    <image class='b-audit-image' src='https://wxapi.benpaobao.com/static/app_img/v2/b-audit-icon.png'></image>
                    <view class='b-auditing'>
                      <text wx:if="{{ status === 'installAudit' }}">审核通过后，系统将自动开始投放广告</text>
                      <text wx:if="{{ status === 'checkAudit' }}">检测审核中，通过后可提取收益</text>
                    </view>
                  </view>
                </view>
              </block>
              <!-- 待检测 -->
              <block wx:elif="{{ status === 'needCheck' }}">
                <view class='b-content-margin'>
                  <view class='b-need-check-content'>
                    <text>广告已结束，检测领取收益</text>
                  </view>
                </view>
              </block>
              <!-- 异常 -->
              <block wx:elif="{{ status === 'installFail' || status === 'checkfail' }}">
                <view class='b-content-margin'>
                  <view class='b-audit-fail'>
                    <!-- 安装异常 -->
                    <block wx:if='{{ status === "installFail" }}'>
                      <view class='b-address' bindtap='handleShowAddress' data-address='{{ "一号车库一号车库一号车库一号车库一号车库一号车库一号车库" }}'>
                        <image class='b-time-image' src='https://wxapi.benpaobao.com/static/app_img/v2/b-location-icon.png'></image>
                        <view class='b-time-text'>
                          <text>一号车库一号车库一号车库一号车库一号车库一号车库一号车库</text>
                        </view>
                        <!-- 导航 -->
                        <view class='b-go-map' catchtap='handleNavigation'>
                          <image class='b-map-image' src='https://wxapi.benpaobao.com/static/app_img/v2/b-nav-icon.png'></image>
                          <view class='b-map-text'>
                            <text>导航</text>
                          </view>
                        </view>
                      </view>
                      <view class='b-install-fail-content'>
                        <text>广告画面安装不合格，请重新返回网点；</text>
                      </view>
                      <view>
                        <text>签到后等待重新安装</text>
                      </view>
                    </block>
                    <!-- 检测异常 -->
                    <block wx:if='{{ status === "checkfail" }}'>
                      <text>广告画面检测不合格，请拍照重新检测</text>
                    </block>
                  </view>
                </view>
              </block>
            </view>
          </block>
          <!-- 投放中-->
          <block wx:if='{{ status === "runingFixed" || status === "runingByTime" }}'>
            <view>
              <!-- 状态标题 -->
              <view class='b-task-status-title'>
                <view class='b-run-tip'>
                  <text>{{ status === "runingByTime"? "累计收益:" : "预计总收益:" }}</text>
                </view>
                <view class='b-run-income'>
                  <text>{{ status === "runingByTime"? runningTask.addUpAmount : runningTask.amountInfo.predict_amount }}</text>
                </view>
                <view class='b-task-status'>
                  <text>投放中</text>
                </view>
              </view>
              <view class='b-run-income-tip'>
                <text>投放周期结束后您可以在待收收益中领取广告奖励</text>
              </view>
              <view class='b-run-detail'>
                <!-- 滴滴双证车主 -->
                <block wx:if="{{ status === 'runingByTime' }}">
                  <view class='b-run-item'>
                    <view class='b-run-top'>
                      <block wx:if="{{ runningTask.yesterdayAmount }}">
                          <view class='b-run-item-left'>{{ runningTask.yesterdayAmount }}
                            <text wx:if="{{ runningTask.yesterdayAmount.level == 1 }}">小于{{ runningTask.yesterdayAmount.duration_max }}</text>
                            <text wx:if="{{ runningTask.yesterdayAmount.level == 2 }}">{{ runningTask.yesterdayAmount.duration_max }}</text>
                            <text wx:if="{{ runningTask.yesterdayAmount.level == 3 }}">{{ runningTask.yesterdayAmount.duration }}</text>
                            <text wx:if="{{ runningTask.yesterdayAmount.level == 4 }}">{{ runningTask.yesterdayAmount.duration }}</text>
                          </view>
                          <view class='b-run-item-right'>时</view>
                      </block>
                      <block wx:else>
                          <view class="b-run-statistics">统计中,请耐心等待</view>
                      </block>
                    </view>
                    <view class='b-run-item-bottom'>昨日在线时长</view>
                  </view>
                  <view class='b-run-item'>
                    <view class='b-run-top'>
                        <block wx:if="{{ runningTask.yesterdayAmount }}">
                            <view class='b-run-item-left'>{{ runningTask.yesterdayAmount.amount }}</view>
                            <view class='b-run-item-right'>元</view>
                        </block>
                        <block wx:else>
                            <view class="b-run-statistics">统计中,请耐心等待</view>
                        </block>
                    </view>
                    <view class='b-run-item-bottom'>昨日收益</view>
                  </view>
                </block>
                <!-- 非滴滴双证车主 -->
                <block wx:else>
                  <view class='b-run-item'>
                    <view class='b-run-top'>
                      <view class='b-run-item-left'>{{ runningTask.amountInfo.days }}</view>
                      <view class='b-run-item-right'>天</view>
                    </view>
                    <view class='b-run-item-bottom'>累计投放天数</view>
                  </view>
                </block>
              </view>
            </view>
          </block>
        </view>

        <!-- 广告公共部分 -->
        <view class='b-task-ad-container'>
          <image class='b-task-image' src='{{ runningTask.logo }}'></image>
          <view class='b-task-ad-info'>
            <view class='b-info-name'>
              <text>{{ runningTask.ad_name }}</text>
            </view>
            <view class='b-info-date'>
              <text>投放时间:{{ runningTask.date }}</text>
            </view>
          </view>
          <!-- action button -->
          <view class='b-task-action'>
            <button class='b-action-btn b-action-cancel' wx:if='{{ status === "subscribed" }}' bindtap='handleUnSubscribe'>取消预约</button>
            <block wx:if='{{ status === "subscribed" || status === "installFail" }}'>
              <button class='b-action-btn' bindtap='handleAction'>签到</button>
            </block>
            <block wx:elif='{{ status === "signed" || status === "installed" }}'>
              <button class='b-action-btn' bindtap='handleAction'>上画登记</button>
            </block>
            <block wx:elif='{{ status === "needCheck" }}'>
              <button class='b-action-btn' bindtap='handleAction'>下画检测</button>
            </block>
            <block wx:elif='{{ status === "checkfail" }}'>
              <button class='b-action-btn' bindtap='handleAction'>重新检测</button>
            </block>
          </view>
        </view>
      </view>
    </block>
    <!-- 已完成任务列表 -->
    <block wx:if='{{ overTask && overTask.length !== 0 }}'>
      <view class='b-task-title'>
        <text>已完成</text>
      </view>
      <view class='finish-container' wx:for='{{ overTask }}' wx:for-item='finish' wx:key='finish.id' data-adId="{{ finish.id }}" bindtap="handleAdDetail">
        <image class='ad-image' src='{{ finish.logo }}' mode='aspectFill'></image>
        <view class='ad-finish-item'>
          <view class='ad-name'>
            <text>{{ finish.ad_name }}</text>
          </view>
          <view class='ad-middle'>
            <view class='b-ad-middle-left'>
              <view class='ad-income'>
                <text>实际收益：</text>
              </view>
              <view class='ad-money'>
                <text>{{ finish.real_amount }}</text>
              </view>
            </view>
            <view class='ad-status'>
              <text>已完成</text>
            </view>
          </view>
          <view class='ad-time'>
            <view class='ad-time-title'>
              <text>投放时间：</text>
            </view>
            <view class='ad-time-detail'>
              <text>{{ finish.begin_date + "-" + finish.end_date }}</text>
            </view>
          </view>
        </view>
        <view class='b-task-line'></view>
      </view>
    </block>
  </block>
  <!-- 空布局 -->
  <block wx:else>
    <emptyView title='您还没有相关的任务' content='去广告市场看看吧~' topMargin='80' />
  </block>
</view>

<!-- 轻提示 -->
<b-toast id="toast"></b-toast>

<!-- 签到提示 -->
<model visible="{{ visibleSign }}" title="签到提示" confirmText="我知道了" showCancel='{{ false }}' bind:confirm="handleSignTipdConfirm">
  <view class='subscribe-wrapper'>
    <view class='b-cancel-queue-tip'>
      <view class='b-queue-model-item'>您未到达签到范围，</view>
      <view class='b-queue-model-item'>请在距离网点500m内签到！</view>
    </view>
  </view>
</model>

<!-- 不可取消提示 -->
<model visible="{{ visibleSubTip }}" title="取消提示" cancelText='联系客服' confirmText="我知道了" bind:cancel="handleContactService" bind:confirm='handleUnableCancel'>
  <view class='subscribe-wrapper'>
    <view class='b-cancel-queue-tip'>
      <view class='b-queue-model-item'>您已错过取消时间，</view>
      <view class='b-queue-model-item'>可联系客服协助处理！</view>
    </view>
  </view>
</model>

<!-- 取消预约提示 -->
<model visible="{{ visibleSubCancelModel }}" title="取消提示" cancelText='暂不取消' confirmText="取消预约" confirmLoading="{{ showCancelLoading }}" bind:cancel="handleNotCancel" bind:confirm='handleSureCancel'>
    <view class='subscribe-wrapper'>
      <view class='b-cancel-queue-tip'>
        <view class='b-queue-model-item'>您确定要取消预约吗？</view>
      </view>
    </view>
  </model>